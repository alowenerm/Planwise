<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Wise</title>
    
    <link rel="icon" type="image/png" href="https://alowenerm.github.io/Ciclos/brickwise-ft.png">

    <!-- External CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Frappe Gantt CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">

    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- External JS Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
</head>
<body class="sidebar-collapsed">

    <!-- Contenedor de Autenticación -->
    <div id="auth-container">
        <div class="card auth-card">
            <div class="card-body">
                <div class="text-center mb-4">
                    <img src="https://alowenerm.github.io/Ciclos/brickwise-ft.png" alt="Logo" style="height: 80px;">
                    <h4 class="mt-3">Bienvenido al Gestor de Tareas</h4>
                    <p class="text-muted">Inicia sesión para continuar</p>
                </div>
                <div id="auth-error" class="alert alert-danger" style="display: none;"></div>
                <form id="login-form">
                    <div class="mb-3">
                        <label for="email" class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <div class="text-end mb-3">
                        <a href="#" id="forgot-password-link" class="form-text" style="text-decoration: none;">¿Olvidaste tu contraseña?</a>
                    </div>
                    <div class="d-grid gap-2 mb-3">
                        <button type="submit" id="login-btn" class="btn btn-primary">Iniciar Sesión</button>
                        <button type="button" id="signup-btn" class="btn btn-outline-secondary">Registrarse</button>
                    </div>
                    <div class="d-grid">
                         <button id="google-signin-btn" class="btn btn-light border">
                            <i class="bi bi-google me-2"></i>
                            Continuar con Google
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Contenedor principal de la aplicación -->
    <div id="app-container" class="d-flex">
        <!-- Barra lateral de navegación -->
        <div id="sidebar" class="d-flex flex-column flex-shrink-0 p-3 bg-light border-end">
            <ul class="nav nav-pills flex-column mb-auto" id="myTab" role="tablist">
                <li class="nav-item mb-2">
                    <button id="sidebar-toggle" class="nav-link text-center">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </li>
                <li class="nav-item mb-1" role="presentation">
                    <button class="nav-link active" id="tasks-tab-btn" data-bs-toggle="pill" data-bs-target="#tasks" type="button" role="tab">
                        <i class="bi bi-check2-square"></i> <span class="nav-link-text">Tareas</span>
                    </button>
                </li>
                <li class="nav-item mb-1" role="presentation">
                    <button class="nav-link" id="gantt-tab-btn" data-bs-toggle="pill" data-bs-target="#gantt" type="button" role="tab">
                        <i class="bi bi-bar-chart-line"></i> <span class="nav-link-text">Carta Gantt</span>
                    </button>
                </li>
                 <li class="nav-item dropdown user-menu-item mt-auto">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle"></i>
                        <span id="sidebar-user-info" class="nav-link-text"></span>
                    </a>
                    <ul class="dropdown-menu user-dropdown">
                        <li><a class="dropdown-item" href="#" id="logout-btn-sidebar">Cerrar Sesión</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- Contenedor de contenido principal -->
        <div id="main-content-wrapper" class="flex-grow-1">
            <div class="container-fluid mb-5">
                <div id="app-header" class="sticky-top">
                    <!-- Barra superior de acciones -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                         <div class="d-flex align-items-center gap-3 flex-grow-1">
                            <a href="#">
                                <img src="https://alowenerm.github.io/Ciclos/brickwise-ft.png" alt="Logo" style="height: 48px;">
                            </a>
                            <input type="text" class="form-control task-list-name-header" id="taskListName" value="Nueva Lista de Tareas">
                        </div>
                        <div class="d-flex gap-2 align-items-center">
                            <input type="file" id="import-file-input" accept=".json" style="display: none;">
                            <span id="save-status"></span>
                            <button id="new-task-list-btn" class="btn btn-outline-secondary btn-xs" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Nueva Lista"><i class="bi bi-file-earmark-plus"></i></button>
                            <button id="open-task-lists-btn" class="btn btn-outline-secondary btn-xs" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Mis Listas"><i class="bi bi-folder2-open"></i></button>
                            <label for="import-file-input" id="import-model-btn" class="btn btn-outline-secondary btn-xs mb-0" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Importar"><i class="bi bi-upload"></i></label>
                            <button id="export-model-btn" class="btn btn-outline-secondary btn-xs" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Exportar"><i class="bi bi-download"></i></button>
                            <button id="copy-tasks-btn" class="btn btn-outline-secondary btn-xs" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Copiar Tareas al Portapapeles"><i class="bi bi-clipboard"></i></button>
                            <button id="share-task-list-btn" class="btn btn-outline-secondary btn-xs" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Compartir Lista"><i class="bi bi-people"></i></button>
                        </div>
                    </div>
                    <!-- Contenedor de KPIs -->
                    <div id="header-kpi-container" class="d-flex flex-column gap-2">
                        <div class="d-flex gap-2 justify-content-between">
                            <div id="kpi1" class="header-kpi"><div class="header-kpi-label">TOTAL TAREAS</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi2" class="header-kpi"><div class="header-kpi-label">PENDIENTES</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi3" class="header-kpi"><div class="header-kpi-label">EN PROGRESO</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi4" class="header-kpi"><div class="header-kpi-label">COMPLETADAS</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi5" class="header-kpi"><div class="header-kpi-label">TOTAL</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi6" class="header-kpi"><div class="header-kpi-label">KPI 6</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi7" class="header-kpi"><div class="header-kpi-label">KPI 7</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi8" class="header-kpi"><div class="header-kpi-label">KPI 8</div><div class="header-kpi-value">--</div></div>
                        </div>
                        <div class="d-flex gap-2 justify-content-between">
                            <div id="kpi9" class="header-kpi"><div class="header-kpi-label">INICIO PROYECTO</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi10" class="header-kpi"><div class="header-kpi-label">TÉRMINO PROYECTO</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi11" class="header-kpi"><div class="header-kpi-label">FECHA ACTUAL</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi12" class="header-kpi"><div class="header-kpi-label">% PLAZO TRANSCURRIDO</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi13" class="header-kpi"><div class="header-kpi-label">% TAREAS COMPLETADAS</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi14" class="header-kpi"><div class="header-kpi-label">KPI 14</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi15" class="header-kpi"><div class="header-kpi-label">KPI 15</div><div class="header-kpi-value">--</div></div>
                            <div id="kpi16" class="header-kpi"><div class="header-kpi-label">KPI 16</div><div class="header-kpi-value">--</div></div>
                        </div>
                    </div>
                </div>
                <!-- Contenido de las Pestañas -->
                <div class="tab-content" id="myTabContent">
                    <!-- PESTAÑA TAREAS -->
                    <div class="tab-pane fade show active p-3 border rounded" id="tasks" role="tabpanel" aria-labelledby="tasks-tab-btn">
                        <div class="card">
                            <div class="card-header fw-bold d-flex justify-content-between align-items-center">
                                <div>
                                    <span id="task-list-title">Lista de Tareas</span>
                                    <span id="breadcrumb-title" class="text-muted fw-normal ms-2"></span>
                                </div>
                            </div>

                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th style="width: 30px;"><i class="bi bi-arrows-move"></i></th>
                                                <th style="width: 10%;">Responsable</th>
                                                <th style="width: 25%;">Tarea</th>
                                                <th style="width: 7%;">Valor</th>
                                                <th style="width: 5%;">Pred.</th>
                                                <th style="width: 5%;">Sub.T</th>
                                                <th style="width: 10%;">Fecha Inicio</th>
                                                <th style="width: 10%;">Fecha Fin</th>
                                                <th style="width: 8%;">Duración (días)</th>
                                                <th style="width: 12%;">Estado</th>
                                                <th style="width: 9%;">Prioridad</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="tasks-tbody"></tbody>
                                    </table>
                                </div>
                                <button id="add-task" class="btn btn-sm btn-outline-primary mt-2">+ Agregar Tarea</button>
                            </div>
                        </div>
                    </div>
                    <!-- PESTAÑA CARTA GANTT -->
                    <div class="tab-pane fade p-3 border rounded" id="gantt" role="tabpanel" aria-labelledby="gantt-tab-btn">
                        <div class="card">
                            <div class="card-header fw-bold d-flex justify-content-between align-items-center">
                                <span>Carta Gantt del Proyecto</span>
                                <div class="btn-group btn-group-sm" id="gantt-view-mode-buttons">
                                    <!-- Los botones de vista se generarán aquí -->
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="gantt-chart-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Compartir -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="shareModalLabel">Compartir Lista de Tareas</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="text-muted">Añade usuarios por su correo electrónico para darles acceso a esta lista.</p>
            <div id="share-error" class="alert alert-danger" style="display: none;"></div>
            <div class="input-group mb-3">
              <input type="email" class="form-control" id="share-email-input" placeholder="Correo electrónico del usuario">
              <select class="form-select" id="share-role-select" style="flex: 0 0 120px;">
                <option value="editor">Editor</option>
                <option value="viewer">Solo Lectura</option>
              </select>
              <button class="btn btn-success" type="button" id="add-user-btn">Añadir</button>
            </div>
            <hr>
            <h6>Usuarios con Acceso</h6>
            <ul class="list-group" id="user-access-list"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para listar Tareas -->
    <div class="modal fade" id="taskListsModal" tabindex="-1" aria-labelledby="taskListsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="taskListsModalLabel">Mis Listas de Tareas</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="task-list-container">
              <p class="text-muted">Cargando listas...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Dependencias -->
    <div class="modal fade" id="dependencyModal" tabindex="-1" aria-labelledby="dependencyModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="dependencyModalLabel">Gestionar Dependencias para: <span id="dependency-task-name" class="fw-bold"></span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="dependency-modal-body-content">
              <p class="text-muted">Cargando tareas disponibles...</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="save-dependencies-btn">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- External JS Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
    
    <!-- Our Custom Scripts (Order is important!) -->
    <script src="firebase-config.js"></script>
    <script src="gantt-calculator.js"></script>
    <script src="gantt-chart.js"></script>
    <script src="main.js"></script>

</body>
</html>